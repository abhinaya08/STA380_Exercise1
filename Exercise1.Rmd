---
title: "STA380_Exercise1"
author: "Abhinaya, Jui, Sherlley"
date: "August 7, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

# Question 1

```{r, message = FALSE}

```

# Question 2

You can also embed plots, for example:

```{r, message = FALSE}

```

# Question 3

## Bootstrapping

First, we select the stocks that are of interest to us from the quantmod package

```{r Boots_initialization, message=FALSE}
library(mosaic)
library(quantmod)
library(foreach)

mystocks = c("SPY", "TLT", "LQD", "EEM", "VNQ")
myprices = getSymbols(mystocks)

for(ticker in mystocks) {
  expr = paste0(ticker, "a = adjustOHLC(", ticker, ")")
  eval(parse(text=expr))
  }


# Combine all the returns in a matrix
all_returns = cbind(ClCl(SPYa),
                    ClCl(TLTa),
                    ClCl(LQDa),
                    ClCl(EEMa),
                    ClCl(VNQa))
head(all_returns)
```

As we can see above, all_returns has the closing returns for the 5 stocks we want to invest in. To determine which out of these are risky and stable, we will plot their returns and check their trend

```{r Boots_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
#plotting since 2007 and since 2017 to compare

chartSeries(SPYa,TA='addBBands();
                    addBBands(draw="p");
                    addVo()', 
                subset='2017-01::2018',
                theme="white"
                )

chartSeries(TLTa,TA='addBBands();
                    addBBands(draw="p");
                    addVo()', 
                subset='2017-01::2018',
                theme="white"
                )

chartSeries(LQDa,TA='addBBands();
                    addBBands(draw="p");
                    addVo()', 
                subset='2017-01::2018',
                theme="white"
                )


chartSeries(EEMa,TA='addBBands();
                    addBBands(draw="p");
                    addVo()', 
                subset='2017-01::2018',
                theme="white"
                ) 

chartSeries(VNQa,TA='addBBands();
                    addBBands(draw="p");
                    addVo()', 
                subset='2017-01::2018',
                theme="white"
                )
```

From the charts we can conclude that Emerging markets and Real estate exchange-traded funds have been rather unstable with higher returns

### (a) Simulating for even split

```{r Boots_evensim}
set.seed(12345)

all_returns = as.matrix(na.omit(all_returns))

n_days = 20
initial_wealth = 100000
sim1 = foreach(i=1:50000, .combine='rbind') %do% {
  total_wealth = initial_wealth
  weights = c(0.2, 0.2, 0.2, 0.2, 0.2)
  holdings = weights * total_wealth
  wealthtracker = rep(0, n_days)
  for(today in 1:n_days) {
    return.today = resample(all_returns, 1, orig.ids=FALSE)
    holdings = holdings + holdings*return.today
    total_wealth = sum(holdings)
    wealthtracker[today] = total_wealth
    holdings = total_wealth * weights
  }
  wealthtracker
}

# Calculate 5% value at risk
quantile(sim1[,n_days], 0.05) - initial_wealth

```

### (b) Simulating for safe split

```{r Boots_safesim}
all_returns = as.matrix(na.omit(all_returns))

n_days = 20
initial_wealth = 100000
sim1 = foreach(i=1:50000, .combine='rbind') %do% {
  total_wealth = initial_wealth
  weights = c(1/3, 1/3, 1/3, 0,0)
  holdings = weights * total_wealth
  wealthtracker = rep(0, n_days)
  for(today in 1:n_days) {
    return.today = resample(all_returns, 1, orig.ids=FALSE)
    holdings = holdings + holdings*return.today
    total_wealth = sum(holdings)
    wealthtracker[today] = total_wealth
    holdings = total_wealth * weights
  }
  wealthtracker
}

# Calculate 5% value at risk
quantile(sim1[,n_days], 0.05) - initial_wealth

```

### (b) Simulating for aggressive split

```{r Boots_aggsim}
all_returns = as.matrix(na.omit(all_returns))

n_days = 20
initial_wealth = 100000
sim1 = foreach(i=1:50000, .combine='rbind') %do% {
  total_wealth = initial_wealth
  weights = c(0, 0, 0, 0.5, 0.5)
  holdings = weights * total_wealth
  wealthtracker = rep(0, n_days)
  for(today in 1:n_days) {
    return.today = resample(all_returns, 1, orig.ids=FALSE)
    holdings = holdings + holdings*return.today
    total_wealth = sum(holdings)
    wealthtracker[today] = total_wealth
    holdings = total_wealth * weights
  }
  wealthtracker
}

# Calculate 5% value at risk
quantile(sim1[,n_days], 0.05) - initial_wealth

```
## Question 4

```{r, message = FALSE}

```
